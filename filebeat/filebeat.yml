# Filebeat Configuration
# Reference: https://www.elastic.co/guide/en/beats/filebeat/index.html

# ============================== Filebeat Inputs ===============================
# We are ingesting Docker container logs generated by T-Pot CE.
# The input type is set to "log" since container output is written as log files.

# TpotCE stores logs in "/var/lib/docker/containers/*/*.log", as we are hosting both filebeat and TpotCE locally

filebeat.inputs:
  - type: log
    enabled: true
	
    # T-Pot CE stores its container logs at the following path:
    # Each container has a JSON-formatted log file located here.
    paths:
      - /var/lib/docker/containers/*/*.log
	  
	# Enable JSON decoding of log lines for structured parsing.
    json:
      keys_under_root: true
      add_error_key: true
      message_key: log
    
	# Multiline support for logs that span multiple lines
	# Start of newline is "{"
	multiline:
      pattern: '^{'
      negate: true
      match: after




# ============================== Filebeat Output ===============================
# Logs are forwarded to Logstash, running locally on port 5044.
# Logstash does further parsing and forwards data to OpenSearch.


output.logstash:
  hosts: ["localhost:5044"]


# ============================== Optional ======================================

#Store Filebeat's internal state (which logs were read) to avoid duplicate ingestion after reboots
filebeat.registry.path: /var/lib/filebeat/registry

# Optional: Enable file-based logging for troubleshooting and persistent logs
logging.level: info
logging.to_files: true
logging.files:
  path: /var/log/filebeat
  name: filebeat
  keepfiles: 7
  permissions: 0644
